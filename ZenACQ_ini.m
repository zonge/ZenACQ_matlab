function  handles = ZenACQ_ini(handles)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%main.ProgramVersion = 'v3';     % PROGRAM VERSIONmain.ProgramName = 'ZenACQ';     % PROGRAM NAME%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%main.Language_ext = '*.lan';     % READ LANGUAGE FILESmain.Setting_ext = 'ZenACQ.cfg'; % CONFIG FILE NAMEcolordef white;             % COLOR THEME%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% DELETE EXISTING OPEN SERIAL PORTSnewobjs=instrfind;if ~isempty(newobjs);fclose(newobjs);end% DELETE EXISTING TIMERnewtimer=timerfind;if ~isempty(newtimer);stop(newtimer);delete(newtimer);end% INITIALISE GRAPHICSset(handles.ZenACQ,'Name',[main.ProgramName ' ' num2str(main.ProgramVersion) ])scrsz = get(0,'ScreenSize');handles.GUI.left_bar=scrsz(4)/2;handles.GUI.bottom_bar=scrsz(4)/3;handles.GUI.width_bar=280;handles.GUI.height_bar=60;main.GUI=handles.GUI;% READ LANGUAGE FILEhandles.language = m_get_language_key(main.Language_ext);% set language variableset(handles.receiver,'String',handles.language.Receiver_str)set(handles.transmitter,'String',handles.language.Transmitter_str)set(handles.data_transfert,'String',handles.language.Data_transfer_str)set(handles.calibration,'String',handles.language.Calibration_str)set(handles.setting,'String',handles.language.Settings_str)set(handles.option_box,'String',handles.language.Options_str)% READ SETTING FILEfirst_time=false;if ~exist(main.Setting_ext,'file');  %WRITE NEW CFG file | default : cd location and Arizona time.    first_time=true;    fid = fopen(main.Setting_ext, 'w');    fprintf(fid,'$z3d_location = %s\n',cd);    fprintf(fid,'$time_zone = %s\n','-7');    fprintf(fid,'$ZenACQ_mode = %s\n','1');    fclose(fid);    % SET VARIABLE to the other windowsendhandles.setting = m_get_setting_key(main.Setting_ext,handles,true);% IF TX ACTIVATED.if str2double(handles.setting.ZenACQ_mode)==2 % IF TX MODE    set(handles.receiver,'Position',[5.6 30.538 44.4 5.692]);    set(handles.transmitter,'Visible','on','Position',[5.6 24.5 44.4 5.692])else                                          % IF NOT TX MODE    set(handles.receiver,'Position',[5.6 27 44.4 9.231]);    set(handles.transmitter,'Visible','off','Position',[5.6 23.692 44.4 2.538])end% DEFAULT PARAMETERhandles.main = main;% TIMERA.pass=handles;handles.timer_start = timer('TimerFcn',@timer_ZenACQ,'BusyMode','queue','UserData'...                                  ,A,'ExecutionMode','fixedRate','Period',1.0,'Name','ACQ_timer');start(handles.timer_start);% LOGOrgb = imread('Zonge_Int_logo_color.jpg');axes(handles.logo)image(rgb);axis off;% FIRST TIMEif first_time==true    welcome=helpdlg('Welcome to ZenACQ. Click OK to set up your setting. Please verify your settings prior using the program.',...    'Point Selection');    waitfor(welcome)        ZenACQ_vars.main=main;    ZenACQ_vars.setting=handles.setting;    ZenACQ_vars.language=handles.language;    setappdata(0,'tunnel',ZenACQ_vars);    ZenPREF        % UPDATE GUI AND PARAMETERS    handles.setting = m_get_setting_key(handles.main.Setting_ext,handles,true);        if str2double(handles.setting.ZenACQ_mode)==2 % IF TX MODE        set(handles.receiver,'Position',[5.6 30.538 44.4 5.692]);        set(handles.transmitter,'Visible','on','Position',[5.6 24.5 44.4 5.692])    else                                          % IF NOT TX MODE        set(handles.receiver,'Position',[5.6 27 44.4 9.231]);        set(handles.transmitter,'Visible','off','Position',[5.6 23.692 44.4 2.538])    endend