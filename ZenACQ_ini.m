function  handles = ZenACQ_ini(handles)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%main.ProgramVersion = 'v3.4e';   % PROGRAM VERSIONmain.ProgramName = 'ZenACQ';     % PROGRAM NAME%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%main.Language_ext = '*.lan';     % READ LANGUAGE FILESmain.Setting_ext = 'ZenACQ.cfg'; % CONFIG FILE NAMEmain.calibrate_file_name='antenna.cal'; % ANTENNA CALIBRATION FILE NAMEmain.TX_cal_file_name='tx.cal'; % TX CALIBRATION FILE NAMEmain.layout_folder='layout';    % Layout Folder namecolordef white;             % COLOR THEME%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%main.color=[ 0, 0.4470, 0.7410; ...                0.8500, 0.3250, 0.0980; ...                0.9290, 0.6940, 0.1250; ...                0.4940, 0.1840, 0.5560; ...                0.4660, 0.6740, 0.1880; ...                0.3010, 0.7450, 0.9330; ...                0.6350, 0.0780, 0.1840; ...                1.0000, 0.0000, 0.0000; ...                0.2500, 0.2500, 0.2500];% CLOSE ALL OTHER WINDOWSfigHandles = findall(0,'Type','figure');for i=1:size(figHandles,1);if ~strcmp(figHandles(i).Tag,'ZenACQ');close(figHandles(i));end;end            % DELETE EXISTING OPEN SERIAL PORTSnewobjs=instrfind;if ~isempty(newobjs);fclose(newobjs);end% DELETE EXISTING TIMERnewtimer=timerfind;if ~isempty(newtimer);stop(newtimer);delete(newtimer);end% INITIALISE GRAPHICSset(handles.ZenACQ,'Name',[main.ProgramName ' ' num2str(main.ProgramVersion) ])scrsz = get(0,'ScreenSize');handles.GUI.left_bar=scrsz(4)/2;handles.GUI.bottom_bar=scrsz(4)/3;handles.GUI.width_bar=280;handles.GUI.height_bar=60;main.GUI=handles.GUI;% READ LANGUAGE FILEhandles.language = m_get_language_key(main.Language_ext);% set language variabletryset(handles.receiver,'String',handles.language.Receiver_str)set(handles.transmitter,'String',handles.language.Transmitter_str)set(handles.data_transfert,'String',handles.language.Data_transfer_str)set(handles.calibration,'String',handles.language.Calibration_str)set(handles.ZenACQsetting,'String',handles.language.Settings_str)set(handles.option_box,'String',handles.language.Options_str)catchend% READ SETTING FILEfirst_time=false;if ~exist(main.Setting_ext,'file');  %WRITE NEW CFG file | default : cd location and Arizona time.    found_time_zone='-7';    try    rk='HKEY_LOCAL_MACHINE';    sk=['system\currentcontrolset\','control\timezoneinformation'];    n=winqueryreg('name',rk,sk);    found_time_zone=num2str(double(winqueryreg(rk,sk,n{1}))/-60);    catch        end    first_time=true;    fid = fopen(main.Setting_ext, 'w');    fprintf(fid,'$z3d_location = %s\n',cd);    fprintf(fid,'$time_zone = %s\n',found_time_zone);    fprintf(fid,'$ZenACQ_mode = %s\n','1');    fprintf(fid,'$ZenCSsr = %s\n','2');    fprintf(fid,'$RealTimeSR = %s  // will not work higher than 2 ==> 1024Hz\n','0');    fclose(fid);    % SET VARIABLE to the other windowsendhandles.setting = m_get_setting_key(main.Setting_ext,handles,true);if str2double(handles.setting.ZenACQ_mode)==1   % IF RX MODE    set(handles.receiver,'Position',[5.6 21 44.4 9.231]);    set(handles.transmitter,'Visible','off','Position',[5.6 19 44.4 2.538])else                                            % IF TX MODE    set(handles.receiver,'Position',[5.6 26 44.4 5.692]);    set(handles.transmitter,'Visible','on','Position',[5.6 19.5 44.4 5.692])    % SET DUTY    if str2double(handles.setting.ZenACQ_mode)==2        main.duty_cycle=100;    elseif str2double(handles.setting.ZenACQ_mode)==3        main.duty_cycle=50;    end    end% DEFAULT PARAMETERhandles.main = main;% TIMERA.pass=handles;handles.timer_start = timer('TimerFcn',@timer_ZenACQ,'BusyMode','queue','UserData'...                                  ,A,'ExecutionMode','fixedRate','Period',1.0,'Name','ACQ_timer');start(handles.timer_start);% LOGOrgb = imread('Zonge_Int_logo_color.jpg');axes(handles.logo)image(rgb);axis off;% FIRST TIMEif first_time==true    welcome=helpdlg(['Welcome to ZenACQ. The time zone found on your computer is : UTC '...        found_time_zone '. Make always sure that your computer time is accurately set to the local time.'...        'Please, Click OK and verify your settings prior using the program.'],...    'ZenACQ Starter');    waitfor(welcome)        ZenACQ_vars.main=main;    ZenACQ_vars.setting=handles.setting;    ZenACQ_vars.language=handles.language;    setappdata(0,'tunnel',ZenACQ_vars);    ZenSettings        % UPDATE GUI AND PARAMETERS    handles.setting = m_get_setting_key(handles.main.Setting_ext,handles,true);        if str2double(handles.setting.ZenACQ_mode)==1   % IF RX MODE    set(handles.receiver,'Position',[5.6 21 44.4 9.231]);    set(handles.transmitter,'Visible','off','Position',[5.6 19 44.4 2.538])    else                                            % IF TX MODE    set(handles.receiver,'Position',[5.6 26 44.4 5.692]);    set(handles.transmitter,'Visible','on','Position',[5.6 19.5 44.4 5.692])    endend%% REPLACE AMTANT.CAL by ANTENNA.CAL if there.if exist(['calibrate' filesep 'amtant.cal'],'file')    copyfile(['calibrate' filesep 'amtant.cal'],['calibrate' filesep main.calibrate_file_name]);    delete(['calibrate' filesep 'amtant.cal']);end